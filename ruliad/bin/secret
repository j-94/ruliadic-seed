#!/usr/bin/env bash
set -euo pipefail
# Usage:
#   bin/secret set-openrouter   (reads key from TTY, encrypts to .secrets/openrouter.key.enc)
#   bin/secret show-openrouter  (prints key to stdout)
#   RULIAD_PASS env can override default password
PASS="${RULIAD_PASS:-GL2-pass-7b3f9f4c}"
case "${1:-}" in
  set-openrouter)
    mkdir -p .secrets
    read -r -s -p "OpenRouter API key: " KEY; echo
    printf "%s" "$KEY" | openssl enc -aes-256-cbc -pbkdf2 -salt -pass pass:"$PASS" -out .secrets/openrouter.key.enc
    chmod 0600 .secrets/openrouter.key.enc
    echo "saved -> .secrets/openrouter.key.enc"
    ;;
  show-openrouter)
    openssl enc -d -aes-256-cbc -pbkdf2 -pass pass:"$PASS" -in .secrets/openrouter.key.enc
    ;;
  *)
    echo "usage: $(basename "$0") {set-openrouter|show-openrouter}" >&2; exit 2;;
esac
